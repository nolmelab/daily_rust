# 채팅 서버 

채팅은 게임 서버와 많이 닮은 구조를 갖습니다. 특히, 인스턴스로 나뉘는 MO나 캐주얼 게임들과 
매우 비슷한 구조입니다. 그래서 채팅 서버를 만들어 보면 게임 서버를 구현할 때 많은 
도움이 됩니다. 

단순하게 전체 채팅만 있는 채팅 서버는 tokio의 examples에 포함되어 있습니다. 처음 시작할 때
간단하게 살펴볼 수 있는 좋은 예제입니다. 

저는 actix를 보면서 액터 모델이 rust의 async 구조 하에서 다양한 게임을 지원할 수 있는 
매우 좋은 틀이 될 수 있다고 생각했습니다. 클라이언트에서 접속한 사용자나 사용자의 캐릭터가 
액터가 된다면 여러 공유 자원에 접근하여 seamless MMORPG와 같이 동시성 요구가 높은 게임도 
지원이 가능할 것 같습니다. 

위치 투명성 (Locational transparency)를 갖는 액터 시스템이 아직 러스트 생태계에서 보이지 
않고 Riker는 TODO 목록에 있는 상태입니다. 

## Actor 크레이트들 

러스트와 비동기 틀이 액터와 잘 맞고 아직 완전한 분산 시스템으로 동작하는 액터 프레임워크가 
없기 때문에 많은 프로젝트들이 진행되고 있습니다. 이는 좋은 일이지만 아직 갈 길이 멀다는 
뜻이기도 합니다. 

- Actix
- Riker 
- Ractor 
- [Coerce-rs](https://github.com/LeonHartley/Coerce-rs)

Actix는 러스트의 비동기 런타임이 성숙하기 전에 이를 보완하기위한 기능들 포함하여 개발된 
것으로 보입니다. 이와 관련된 기법들이나 코드들을 살펴볼 수 있습니다. 

Ractor는 Erlang의 모델을 많이 가져와 적용하려고 하고 있습니다. Erlang의 모델은 액터 모델이기 
때문에 결국 액터 모델에 충실하다고 생각할 수 있습니다. ractor_cluster에서 여러 노드에서 
액터를 두고 서로 통신하면서 처리할 수 있는 기능을 포함하고 있습니다. 

Coerce-rs는 Protobuf로 네트워킹을 제공하고 Redis로 storage와 pub/sub 기능을 위해 사용하고 
있습니다. 네트워킹 통합을 위한 코드를 보면 도움이 많이 될 것입니다.
  
게임 서버 프로젝트들이 러스트에서는 드문 편입니다. 특이한 현상입니다. 웹 프레임워크가 훨씬 
더 많습니다. 이는 C++ 과는 대조적입니다. github topic에도 정리되는 내용이 적습니다. 

- naia 
- [citybound](https://github.com/citybound/citybound)

비동기를 활용하고 서비스들과 클라이언트를 액터화 하여 게임 시스템 단위로 구조화하면 매우 
잘 구성된 게임 서버를 만들 수 있을 것으로 기대하고 있습니다. 

시작으로 간단한 채팅 서버를 이에 맞춰 개발을 진해합니다. 기존의 액터 시스템을 할용하는 
방식으로 진행해도 괜찮을 듯 합니다. Riker와 Ractor 중에 선택해야 할 것 같습니다. 

## Roadmap 

- Json Codec (Length)
- 메세지 핸들러 

- Single Node Chat Server 
  - RoomManager
  - Room 
  - Session 

- Actor화 
  - ractor의 활용
  - 각 구조의 액터화 
  - 여러 클라이언트를 지원하는 액터 내 통신과 처리 구조 
  - 다듬기 

- Multi Node Chat Server 
  - ractor_cluster로 채팅 기능 확장 
  - XMPP와 Matrix 프로토콜 참고하여 구현 

여러 프로젝트 코드들을 살펴보면서 밑단부터 직접 구현하는 모델과 ractor를 활용한 구현을 
시도하면서 ractor 프로젝트에 참여하여 앞으로 갈지 결정하게 될 것 같습니다. 




