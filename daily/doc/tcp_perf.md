# tcp perf 

tcp 성능을 측정하는 툴을 만들려고 합니다. 여러 연결을 맺고 끊으면서 트래픽을 발생시키고 
성능을 측정합니다. 장시간 실행할 수 있도록 합니다. 

대부분의 환경이 최적의 설정을 갖고 아무런 문제 없이 동작할 것이라고 예상한다면 
그렇지 않다고 단언할 수 있습니다. 그간 만났던 많은 문제들은 대부분 설정상의 이슈들이 
대부분이긴 하지만 놓치기 쉬운 부분이라는 점에서 항상 측정을 통한 검증이 필요합니다. 

예를들어, 다음과 같은 설정 오류들이 있었습니다. 

- NIC의 수신 버퍼가 작아 통신 중 단선이 발생하거나 느리게 동작한다. 
- 윈도우 디펜더와 같이 무거운 처리로 관여하는 도구에 대한 예외 처리가 없어 IO가 느려진다. 
- RSS 큐 크기가 호스트 (하이퍼바이저)와 게스트 간에 다르게 설정되어 단선이 간헐적으로 발생한다. 

목표는 tcping처럼 매우 간단하고 유용하게 사용할 수 있는 도구를 만드는 것입니다. 

## 기능 

TCP 세션 수준에서 연결, 송수신, 종료를 반복합니다. 각 동작의 응답 시간을 기록하고 결과를 
리포팅합니다. 재전송, Ack 시간 등 TCP 수준에서 측정이 필요하다고 볼 수도 있지만 상위 API
수준에서 측정으로도 대상 시스템의 안정적인 동작을 확인할 수 있습니다. 

측정된 결과를 잘 정리하여 비교할 수 있도록 하는 것이 중요합니다. 오류가 발생할 경우 자세히 
볼 수 있도록 해야 합니다. 

## 설계 

러스트로 작성할 때 tokio 외에 특별한 구조를 포함하지 않도록 합니다. LengthDelimitedCodec만 
사용하여 처리 시간을 낭비하지 않습니다. 리포팅은 mpsc 채널을 통해 수집하도록 합니다. 이를 
ratatui로 실시간 표시하고 테스트 종료 후 결과를 원래 콘솔에 남기도록 합니다. 


